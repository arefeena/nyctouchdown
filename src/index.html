<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYC Touchdown</title>
    <meta name="description" content="Tracking friends moving to NYC throughout the year">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="" />
    
    <style>
        :root {
          /* Primitive Color Tokens */
          --color-white: rgba(255, 255, 255, 1);
          --color-black: rgba(0, 0, 0, 1);
          --color-cream-50: rgba(252, 252, 249, 1);
          --color-cream-100: rgba(255, 255, 253, 1);
          --color-gray-200: rgba(245, 245, 245, 1);
          --color-gray-300: rgba(167, 169, 169, 1);
          --color-gray-400: rgba(119, 124, 124, 1);
          --color-slate-500: rgba(98, 108, 113, 1);
          --color-brown-600: rgba(94, 82, 64, 1);
          --color-charcoal-700: rgba(31, 33, 33, 1);
          --color-charcoal-800: rgba(38, 40, 40, 1);
          --color-slate-900: rgba(19, 52, 59, 1);
          --color-teal-300: rgba(50, 184, 198, 1);
          --color-teal-400: rgba(45, 166, 178, 1);
          --color-teal-500: rgba(33, 128, 141, 1);
          --color-teal-600: rgba(29, 116, 128, 1);
          --color-teal-700: rgba(26, 104, 115, 1);
          --color-teal-800: rgba(41, 150, 161, 1);
          --color-red-400: rgba(255, 84, 89, 1);
          --color-red-500: rgba(192, 21, 47, 1);
          --color-orange-400: rgba(230, 129, 97, 1);
          --color-orange-500: rgba(168, 75, 47, 1);

          /* RGB versions for opacity control */
          --color-brown-600-rgb: 94, 82, 64;
          --color-teal-500-rgb: 33, 128, 141;
          --color-slate-900-rgb: 19, 52, 59;
          --color-slate-500-rgb: 98, 108, 113;
          --color-red-500-rgb: 192, 21, 47;
          --color-red-400-rgb: 255, 84, 89;
          --color-orange-500-rgb: 168, 75, 47;
          --color-orange-400-rgb: 230, 129, 97;

          /* Background color tokens (Light Mode) */
          --color-bg-1: rgba(59, 130, 246, 0.08);
          --color-bg-2: rgba(245, 158, 11, 0.08);
          --color-bg-3: rgba(34, 197, 94, 0.08);
          --color-bg-4: rgba(239, 68, 68, 0.08);
          --color-bg-5: rgba(147, 51, 234, 0.08);
          --color-bg-6: rgba(249, 115, 22, 0.08);
          --color-bg-7: rgba(236, 72, 153, 0.08);
          --color-bg-8: rgba(6, 182, 212, 0.08);

          /* Semantic Color Tokens (Light Mode) */
          --color-background: var(--color-cream-50);
          --color-surface: var(--color-cream-100);
          --color-text: var(--color-slate-900);
          --color-text-secondary: var(--color-slate-500);
          --color-primary: var(--color-teal-500);
          --color-primary-hover: var(--color-teal-600);
          --color-primary-active: var(--color-teal-700);
          --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
          --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
          --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
          --color-border: rgba(var(--color-brown-600-rgb), 0.2);
          --color-btn-primary-text: var(--color-cream-50);
          --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
          --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
          --color-error: var(--color-red-500);
          --color-success: var(--color-teal-500);
          --color-warning: var(--color-orange-500);
          --color-info: var(--color-slate-500);
          --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
          --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

          /* Typography */
          --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
          --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
            Monaco, Consolas, monospace;
          --font-size-xs: 11px;
          --font-size-sm: 12px;
          --font-size-base: 14px;
          --font-size-md: 14px;
          --font-size-lg: 16px;
          --font-size-xl: 18px;
          --font-size-2xl: 20px;
          --font-size-3xl: 24px;
          --font-size-4xl: 30px;
          --font-weight-normal: 400;
          --font-weight-medium: 500;
          --font-weight-semibold: 550;
          --font-weight-bold: 600;
          --line-height-tight: 1.2;
          --line-height-normal: 1.5;
          --letter-spacing-tight: -0.01em;

          /* Spacing */
          --space-0: 0;
          --space-1: 1px;
          --space-2: 2px;
          --space-4: 4px;
          --space-6: 6px;
          --space-8: 8px;
          --space-10: 10px;
          --space-12: 12px;
          --space-16: 16px;
          --space-20: 20px;
          --space-24: 24px;
          --space-32: 32px;

          /* Border Radius */
          --radius-sm: 6px;
          --radius-base: 8px;
          --radius-md: 10px;
          --radius-lg: 12px;
          --radius-full: 9999px;

          /* Shadows */
          --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
          --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);

          /* Animation */
          --duration-fast: 150ms;
          --duration-normal: 250ms;
          --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Dark mode colors */
        @media (prefers-color-scheme: dark) {
          :root {
            --color-gray-400-rgb: 119, 124, 124;
            --color-teal-300-rgb: 50, 184, 198;
            --color-gray-300-rgb: 167, 169, 169;
            --color-gray-200-rgb: 245, 245, 245;

            --color-bg-1: rgba(29, 78, 216, 0.15);
            --color-bg-2: rgba(180, 83, 9, 0.15);
            --color-bg-3: rgba(21, 128, 61, 0.15);
            --color-bg-4: rgba(185, 28, 28, 0.15);
            --color-bg-5: rgba(107, 33, 168, 0.15);
            --color-bg-6: rgba(194, 65, 12, 0.15);
            --color-bg-7: rgba(190, 24, 93, 0.15);
            --color-bg-8: rgba(8, 145, 178, 0.15);
            
            --color-background: var(--color-charcoal-700);
            --color-surface: var(--color-charcoal-800);
            --color-text: var(--color-gray-200);
            --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
            --color-primary: var(--color-teal-300);
            --color-primary-hover: var(--color-teal-400);
            --color-primary-active: var(--color-teal-800);
            --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
            --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
            --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
            --color-border: rgba(var(--color-gray-400-rgb), 0.3);
            --color-error: var(--color-red-400);
            --color-success: var(--color-teal-300);
            --color-warning: var(--color-orange-400);
            --color-info: var(--color-gray-300);
            --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
            --color-btn-primary-text: var(--color-slate-900);
            --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
          }
        }

        /* Base styles */
        html {
          font-size: var(--font-size-base);
          font-family: var(--font-family-base);
          line-height: var(--line-height-normal);
          color: var(--color-text);
          background-color: var(--color-background);
          -webkit-font-smoothing: antialiased;
          box-sizing: border-box;
        }

        body {
          margin: 0;
          padding: 0;
        }

        *, *::before, *::after {
          box-sizing: inherit;
        }

        h1, h2, h3, h4, h5, h6 {
          margin: 0;
          font-weight: var(--font-weight-semibold);
          line-height: var(--line-height-tight);
          color: var(--color-text);
          letter-spacing: var(--letter-spacing-tight);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }

        p {
          margin: 0 0 var(--space-16) 0;
        }

        /* Container and Layout */
        .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: var(--space-20);
        }

        /* Header */
        .header {
          text-align: center;
          margin-bottom: var(--space-32);
          padding: var(--space-32) 0;
        }

        .site-title {
          font-size: var(--font-size-4xl);
          font-weight: var(--font-weight-bold);
          color: var(--color-primary);
          margin-bottom: var(--space-16);
          letter-spacing: var(--letter-spacing-tight);
        }

        .site-subtitle {
          font-size: var(--font-size-lg);
          color: var(--color-text-secondary);
          font-weight: var(--font-weight-normal);
          margin: 0;
        }

        /* Section Titles */
        .section-title {
          font-size: var(--font-size-2xl);
          font-weight: var(--font-weight-semibold);
          color: var(--color-text);
          text-align: center;
          margin-bottom: var(--space-24);
        }

        /* Timer Section */
        .timer-section {
          margin-bottom: var(--space-32);
        }

        .timers-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: var(--space-24);
          margin-bottom: var(--space-32);
        }

        .timer-card {
          background: var(--color-surface);
          border: 1px solid var(--color-card-border);
          border-radius: var(--radius-lg);
          padding: var(--space-24);
          box-shadow: var(--shadow-md);
          transition: all var(--duration-normal) var(--ease-standard);
          cursor: pointer;
        }

        .timer-card:hover {
          box-shadow: var(--shadow-lg);
          transform: translateY(-2px);
        }

        .timer-card[data-friend="ravi"] {
          background: var(--color-bg-1);
          border-color: rgba(59, 130, 246, 0.3);
        }

        .timer-card[data-friend="arjun"] {
          background: var(--color-bg-3);
          border-color: rgba(34, 197, 94, 0.3);
        }

        .timer-card[data-friend="nick"] {
          background: var(--color-bg-5);
          border-color: rgba(147, 51, 234, 0.3);
        }

        .friend-info {
          text-align: center;
          margin-bottom: var(--space-20);
        }

        .friend-name {
          font-size: var(--font-size-xl);
          font-weight: var(--font-weight-bold);
          color: var(--color-text);
          margin-bottom: var(--space-8);
        }

        .friend-location {
          font-size: var(--font-size-base);
          color: var(--color-text-secondary);
          margin-bottom: var(--space-4);
        }

        .move-date {
          font-size: var(--font-size-sm);
          color: var(--color-primary);
          font-weight: var(--font-weight-medium);
          margin: 0;
        }

        /* Countdown Styling */
        .countdown {
          display: flex;
          justify-content: space-between;
          gap: var(--space-12);
        }

        .time-unit {
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          flex: 1;
        }

        .time-value {
          font-size: var(--font-size-3xl);
          font-weight: var(--font-weight-bold);
          color: var(--color-primary);
          line-height: 1.2;
          margin-bottom: var(--space-4);
          transition: all var(--duration-fast) var(--ease-standard);
        }

        .time-label {
          font-size: var(--font-size-xs);
          color: var(--color-text-secondary);
          font-weight: var(--font-weight-medium);
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        /* Map Section */
        .map-section {
          margin-bottom: var(--space-32);
        }

        .map-container {
          background: var(--color-surface);
          border: 1px solid var(--color-card-border);
          border-radius: var(--radius-lg);
          overflow: hidden;
          box-shadow: var(--shadow-md);
          position: relative;
        }

        .map {
          height: 500px;
          width: 100%;
          border-radius: var(--radius-lg);
        }

        /* Custom avatar markers */
        .custom-avatar-marker {
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
          overflow: hidden;
        }

        .custom-avatar-marker img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        /* Plane animation */
        .plane-animation {
          position: absolute;
          z-index: 1000;
          width: 30px;
          height: 30px;
          background: #1FB8CD;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
          pointer-events: none;
        }

        .plane-animation::after {
          content: '✈️';
          font-size: 16px;
          transform: rotate(0deg);
          transition: transform 4s ease-in-out;
        }

        .plane-animation.flying::after {
          transform: rotate(-45deg);
        }

        /* Leaflet popup customization */
        .leaflet-popup-content-wrapper {
          background: var(--color-surface);
          color: var(--color-text);
          border-radius: var(--radius-base);
          box-shadow: var(--shadow-lg);
        }

        .leaflet-popup-content {
          font-family: var(--font-family-base);
          font-size: var(--font-size-sm);
          line-height: var(--line-height-normal);
          margin: var(--space-12);
        }

        .leaflet-popup-tip {
          background: var(--color-surface);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
          .container {
            padding: var(--space-16);
          }
          
          .site-title {
            font-size: var(--font-size-3xl);
          }
          
          .site-subtitle {
            font-size: var(--font-size-base);
          }
          
          .timers-grid {
            grid-template-columns: 1fr;
            gap: var(--space-16);
          }
          
          .timer-card {
            padding: var(--space-20);
          }
          
          .countdown {
            gap: var(--space-8);
          }
          
          .time-value {
            font-size: var(--font-size-2xl);
          }
          
          .map {
            height: 400px;
          }
        }

        @media (max-width: 480px) {
          .container {
            padding: var(--space-12);
          }
          
          .header {
            padding: var(--space-20) 0;
          }
          
          .site-title {
            font-size: var(--font-size-2xl);
          }
          
          .timer-card {
            padding: var(--space-16);
          }
          
          .countdown {
            gap: var(--space-4);
          }
          
          .time-value {
            font-size: var(--font-size-xl);
          }
          
          .time-label {
            font-size: 10px;
          }
          
          .map {
            height: 350px;
          }
        }

        /* Animation for timer updates */
        .time-value.updated {
          transform: scale(1.05);
          transition: transform var(--duration-fast) var(--ease-standard);
        }

        .time-value.updated:after {
          transform: scale(1);
        }

        /* Click indicator */
        .timer-card.clicked {
          animation: clickPulse 0.3s ease-out;
        }

        @keyframes clickPulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.02); }
          100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="site-title">NYC Touchdown</h1>
            <p class="site-subtitle">Tracking the journey of friends moving to the Big Apple</p>
        </header>

        <!-- Timer Section -->
        <section class="timer-section">
            <h2 class="section-title">Countdown to NYC</h2>
            <div class="timers-grid">
                <div class="timer-card" data-friend="ravi">
                    <div class="friend-info">
                        <h3 class="friend-name">Ravi</h3>
                        <p class="friend-location">From Toronto</p>
                        <p class="move-date">Moving: September 1, 2025</p>
                    </div>
                    <div class="countdown" id="countdown-ravi">
                        <div class="time-unit">
                            <span class="time-value" id="ravi-days">0</span>
                            <span class="time-label">Days</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="ravi-hours">0</span>
                            <span class="time-label">Hours</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="ravi-minutes">0</span>
                            <span class="time-label">Minutes</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="ravi-seconds">0</span>
                            <span class="time-label">Seconds</span>
                        </div>
                    </div>
                </div>

                <div class="timer-card" data-friend="arjun">
                    <div class="friend-info">
                        <h3 class="friend-name">Arjun</h3>
                        <p class="friend-location">From Sunnyvale</p>
                        <p class="move-date">Moving: December 1, 2025</p>
                    </div>
                    <div class="countdown" id="countdown-arjun">
                        <div class="time-unit">
                            <span class="time-value" id="arjun-days">0</span>
                            <span class="time-label">Days</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="arjun-hours">0</span>
                            <span class="time-label">Hours</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="arjun-minutes">0</span>
                            <span class="time-label">Minutes</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="arjun-seconds">0</span>
                            <span class="time-label">Seconds</span>
                        </div>
                    </div>
                </div>

                <div class="timer-card" data-friend="nick">
                    <div class="friend-info">
                        <h3 class="friend-name">Nick</h3>
                        <p class="friend-location">From Seattle</p>
                        <p class="move-date">Moving: June 1, 2026</p>
                    </div>
                    <div class="countdown" id="countdown-nick">
                        <div class="time-unit">
                            <span class="time-value" id="nick-days">0</span>
                            <span class="time-label">Days</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="nick-hours">0</span>
                            <span class="time-label">Hours</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="nick-minutes">0</span>
                            <span class="time-label">Minutes</span>
                        </div>
                        <div class="time-unit">
                            <span class="time-value" id="nick-seconds">0</span>
                            <span class="time-label">Seconds</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Map Section -->
        <section class="map-section">
            <h2 class="section-title">Current Locations & Journey to NYC</h2>
            <div class="map-container">
                <div id="map" class="map"></div>
            </div>
        </section>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // Friends data with move dates, coordinates, and avatar images
        const friendsData = {
            ravi: {
                name: 'Ravi',
                location: 'Toronto',
                moveDate: new Date('2025-09-01T00:00:00'),
                coordinates: [43.651070, -79.347015],
                avatar: './assets/ravi_avatar.jpeg'
            },
            arjun: {
                name: 'Arjun',
                location: 'Sunnyvale',
                moveDate: new Date('2025-12-01T00:00:00'),
                coordinates: [37.368832, -122.036346],
                avatar: './assets/arjun_avatar.jpeg'
            },
            nick: {
                name: 'Nick',
                location: 'Seattle',
                moveDate: new Date('2026-06-01T00:00:00'),
                coordinates: [47.608013, -122.335167],
                avatar: './assets/nick_avatar.jpeg'
            }
        };

        const nycCoordinates = [40.730610, -73.935242];
        const amarAvatar = './assets/amar_avatar.jpeg';

        // Initialize map
        let map;
        let planeElement = null;

        // Timer update function
        function updateCountdowns() {
            const now = new Date();
            
            Object.keys(friendsData).forEach(friend => {
                const friendData = friendsData[friend];
                const timeDiff = friendData.moveDate - now;
                
                if (timeDiff > 0) {
                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                    
                    updateTimeValue(`${friend}-days`, days);
                    updateTimeValue(`${friend}-hours`, hours);
                    updateTimeValue(`${friend}-minutes`, minutes);
                    updateTimeValue(`${friend}-seconds`, seconds);
                } else {
                    updateTimeValue(`${friend}-days`, 'M');
                    updateTimeValue(`${friend}-hours`, 'O');
                    updateTimeValue(`${friend}-minutes`, 'V');
                    updateTimeValue(`${friend}-seconds`, 'E');
                }
            });
        }

        // Helper function to update time values with animation
        function updateTimeValue(elementId, value) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== value.toString()) {
                element.classList.add('updated');
                element.textContent = value;
                
                setTimeout(() => {
                    element.classList.remove('updated');
                }, 150);
            }
        }

        // Create custom avatar icon
        function createAvatarIcon(avatarUrl, size = 50) {
            return L.divIcon({
                className: 'custom-avatar-marker',
                html: `<img src="${avatarUrl}" alt="Avatar">`,
                iconSize: [size, size],
                iconAnchor: [size/2, size/2]
            });
        }

        // Initialize map with custom avatar markers
        function initializeMap() {
            // Create map centered to show all locations
            map = L.map('map').setView([42.0, -95.0], 4);
            
            // Add tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            // Add markers for each friend's current location with custom avatars
            Object.keys(friendsData).forEach(friendKey => {
                const friend = friendsData[friendKey];
                const avatarIcon = createAvatarIcon(friend.avatar, 50);
                const marker = L.marker(friend.coordinates, { icon: avatarIcon }).addTo(map);
                
                const popupContent = `
                    <div style="text-align: center; padding: 12px; min-width: 200px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                        <img src="${friend.avatar}" alt="${friend.name}" style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 8px; border: 2px solid #1FB8CD;">
                        <h4 style="margin: 0 0 8px 0; color: #ffffff; font-size: 16px; font-weight: 600;">${friend.name}</h4>
                        <p style="margin: 0 0 6px 0; color: #626c71; font-size: 14px;">Currently in ${friend.location}</p>
                        <p style="margin: 0; color: #21808d; font-size: 13px; font-weight: 500;">Moving: ${friend.moveDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                `;
                
                marker.bindPopup(popupContent, {
                    maxWidth: 250,
                    className: 'custom-popup'
                });
            });
            
            // Add marker for NYC destination with Amar's avatar
            const amarIcon = createAvatarIcon(amarAvatar, 60);
            const nycMarker = L.marker(nycCoordinates, { icon: amarIcon }).addTo(map);
            const nycPopupContent = `
                <div style="text-align: center; padding: 12px; min-width: 200px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                    <img src="${amarAvatar}" alt="Amar" style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 8px; border: 2px solid #DB4545;">
                    <h4 style="margin: 0 0 8px 0; color: #ffffff; font-size: 16px; font-weight: 600;">🗽 Amar in NYC</h4>
                    <p style="margin: 0; color: #626c71; font-size: 14px;">Already here waiting for everyone!</p>
                </div>
            `;
            nycMarker.bindPopup(nycPopupContent, {
                maxWidth: 250,
                className: 'custom-popup'
            });
            
            // Fit map to show all markers
            const allCoordinates = [
                ...Object.values(friendsData).map(friend => friend.coordinates),
                nycCoordinates
            ];
            
            const group = new L.featureGroup(
                allCoordinates.map(coord => L.marker(coord))
            );
            
            map.fitBounds(group.getBounds().pad(0.1));
            
            // Add connecting lines from each location to NYC
            Object.values(friendsData).forEach(friend => {
                const polyline = L.polyline([friend.coordinates, nycCoordinates], {
                    color: '#1FB8CD',
                    weight: 2,
                    opacity: 0.6,
                    dashArray: '5, 10'
                }).addTo(map);
            });
        }

        // Animate plane from origin to NYC
        function animatePlane(friend) {
            const friendData = friendsData[friend];
            if (!friendData || !map) return;

            // Remove existing plane if any
            if (planeElement) {
                planeElement.remove();
            }

            // Get map container for absolute positioning
            const mapContainer = map.getContainer();
            const mapRect = mapContainer.getBoundingClientRect();

            // Convert coordinates to pixel positions
            const startPoint = map.latLngToContainerPoint(friendData.coordinates);
            const endPoint = map.latLngToContainerPoint(nycCoordinates);

            // Create plane element
            planeElement = document.createElement('div');
            planeElement.className = 'plane-animation';
            planeElement.style.left = startPoint.x + 'px';
            planeElement.style.top = startPoint.y + 'px';

            // Calculate rotation angle for plane direction
            const angle = Math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x) * (180 / Math.PI);
            
            // Add plane to map container
            mapContainer.appendChild(planeElement);

            // Start animation after a brief delay
            setTimeout(() => {
                planeElement.classList.add('flying');
                planeElement.style.left = endPoint.x + 'px';
                planeElement.style.top = endPoint.y + 'px';
                planeElement.style.transform = `rotate(${angle}deg)`;

                // Remove plane after animation completes
                setTimeout(() => {
                    if (planeElement) {
                        planeElement.remove();
                        planeElement = null;
                    }
                }, 4500);
            }, 100);
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Start countdown timers
            updateCountdowns();
            setInterval(updateCountdowns, 1000);
            
            // Initialize map
            initializeMap();
            
            // Add click handlers to timer cards for plane animation
            document.querySelectorAll('.timer-card').forEach(card => {
                card.addEventListener('click', function() {
                    const friend = this.dataset.friend;
                    
                    // Add visual feedback
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // Animate plane
                    animatePlane(friend);
                });
            });
            
            // Handle window resize for map
            window.addEventListener('resize', function() {
                if (map) {
                    setTimeout(function() {
                        map.invalidateSize();
                    }, 100);
                }
            });
        });

        // Utility function to check if a friend has already moved
        function hasMoved(friendKey) {
            const now = new Date();
            return friendsData[friendKey].moveDate <= now;
        }
    </script>
</body>
</html>